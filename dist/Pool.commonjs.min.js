"use strict";function _interopRequireDefault(e){return e&&e.__esModule?e:{"default":e}}function set_constant(e,t,o){(0,_defineProperty2["default"])(e,t,{writable:!1,configurable:!1,value:o})}Object.defineProperty(exports,"__esModule",{value:!0});var _classCallCheck2=require("babel-runtime/helpers/classCallCheck"),_classCallCheck3=_interopRequireDefault(_classCallCheck2),_createClass2=require("babel-runtime/helpers/createClass"),_createClass3=_interopRequireDefault(_createClass2),_defineProperty=require("babel-runtime/core-js/object/define-property"),_defineProperty2=_interopRequireDefault(_defineProperty),Pool=function(){function e(t){var o=arguments.length<=1||void 0===arguments[1]?-1:arguments[1],r=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],s=r.clearMethodName,n=void 0===s?null:s,i=r.destroyMethodName,a=void 0===i?null:i,l=r.isFactory,c=void 0===l?!1:l;(0,_classCallCheck3["default"])(this,e),this.size=o,set_constant(this,"ObjectConstructor",t),set_constant(this,"objectClearMethodName",n),set_constant(this,"objectDestroyMethodName",a),set_constant(this,"objectConstructorIsFactory",c),set_constant(this,"borrowedObjects",[]),set_constant(this,"availableObjects",[])}return(0,_createClass3["default"])(e,[{key:"destroy",value:function(){this._destroyChildren(this.borrowedObjects),this._destroyChildren(this.availableObjects)}},{key:"_destroyChildren",value:function(e){var t=this.objectDestroyMethodName||this.clearMethodName;if(!t)return void e.splice(0,e.length);for(var o=void 0;o=e.pop();)try{o[t].call(o)}catch(r){if("undefined"==typeof console)throw r;console.log("Error during destroy")}}},{key:"borrows",value:function(){var e=null;return this.hasAvailables()&&(e=0===this.availableObjects.length?this.objectConstructorIsFactory?this.ObjectConstructor():new this.ObjectConstructor:this.availableObjects.pop(),this.borrowedObjects.push(e)),e}},{key:"returns",value:function(e){if(!(e instanceof this.ObjectConstructor))throw new Error("Can't return object which is not a "+this.ObjectConstructor.name);var t=this.borrowedObjects.indexOf(e);if(-1===t){if(this.availableObjects.includes(e))throw new Error(this.ObjectConstructor.name+" already returned !");throw new Error("Object given in Pool#returns() is not referenced in this Pool instance.")}if(this.borrowedObjects.splice(t,1),null!==this.objectClearMethodName)try{e[this.objectClearMethodName].call(e)}catch(o){if("undefined"==typeof console)throw o;console.log("Unable to call method "+this.objectClearMethodName+" on object instance "+String(e))}this.availableObjects.push(e)}},{key:"hasAvailables",value:function(){return-1===this.size||this.borrowedObjects.length<this.size}},{key:"getCountAvailables",value:function(){return this.availableObjects.length}},{key:"getCountBorrowed",value:function(){return this.borrowedObjects.length}},{key:"toString",value:function(){return"Pool<"+this.ObjectConstructor.name+">(borrowed: "+this.getCountBorrowed()+", available: "+this.getCountAvailables()+")"}}]),e}();exports["default"]=Pool;