"use strict";System.register("Pool",[],function(t,e){function o(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function r(t,e,o){Object.defineProperty(t,e,{writable:!1,configurable:!1,value:o})}var s,i;return{setters:[],execute:function(){s=function(){function t(t,e){for(var o=0;o<e.length;o++){var r=e[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,o,r){return o&&t(e.prototype,o),r&&t(e,r),e}}(),i=function(){function t(e){var s=arguments.length<=1||void 0===arguments[1]?-1:arguments[1],i=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],n=i.clearMethodName,a=void 0===n?null:n,l=i.destroyMethodName,c=void 0===l?null:l,h=i.isFactory,u=void 0===h?!1:h;o(this,t),this.size=s,r(this,"ObjectConstructor",e),r(this,"objectClearMethodName",a),r(this,"objectDestroyMethodName",c),r(this,"objectConstructorIsFactory",u),r(this,"borrowedObjects",[]),r(this,"availableObjects",[]),r(this,"awaitCallbacks",[])}return s(t,[{key:"destroy",value:function(){this._destroyChildren(this.borrowedObjects),this._destroyChildren(this.availableObjects),this.awaitCallbacks.length&&this.awaitCallbacks.splice(0,this.awaitCallbacks.length)}},{key:"_destroyChildren",value:function(t){var e=this.objectDestroyMethodName||this.objectClearMethodName;if(!e)return void t.splice(0,t.length);for(var o=void 0;o=t.pop();)try{o[e].call(o)}catch(r){if("undefined"==typeof console)throw r;console.log("Error during destroy")}}},{key:"await",value:function(){var t=this;return this.hasAvailables()?Promise.resolve(this.borrows()):new Promise(function(e,o){t.awaitCallbacks.push(e)})}},{key:"borrows",value:function(){var t=null;return this.hasAvailables()&&(t=0===this.availableObjects.length?this.objectConstructorIsFactory?this.ObjectConstructor():new this.ObjectConstructor:this.availableObjects.pop(),this.borrowedObjects.push(t)),this._onObjectBorrowed&&this._onObjectBorrowed(),t}},{key:"returns",value:function(t){if(!(this.objectConstructorIsFactory||t instanceof this.ObjectConstructor))throw new Error("Can't return object which is not a "+this.ObjectConstructor.name);var e=this.borrowedObjects.indexOf(t);if(-1===e){if(this.availableObjects.indexOf(t)>-1)throw new Error(this.ObjectConstructor.name+" already returned !");throw new Error("Object given in Pool#returns() is not referenced in this Pool instance.")}if(this.borrowedObjects.splice(e,1),null!==this.objectClearMethodName)try{t[this.objectClearMethodName].call(t)}catch(o){if("undefined"==typeof console)throw o;console.log("Unable to call method "+this.objectClearMethodName+" on object instance "+String(t))}this.availableObjects.push(t),this._onObjectReturned&&this._onObjectReturned()}},{key:"hasAvailables",value:function(){return-1===this.size||this.borrowedObjects.length<this.size}},{key:"getCountAvailables",value:function(){return(-1===this.size?Number.MAX_SAFE_INTEGER:this.size)-this.getCountBorrowed()}},{key:"getCountBorrowed",value:function(){return this.borrowedObjects.length}},{key:"toString",value:function(){return"Pool<"+this.ObjectConstructor.name+">(borrowed: "+this.getCountBorrowed()+", available: "+this.getCountAvailables()+")"}},{key:"_onObjectReturned",value:function(){if(console.log("_onObjectReturned"),this.awaitCallbacks.length&&this.hasAvailables()){var t=this.awaitCallbacks.shift();t(this.borrows())}}}]),t}(),t("default",i)}}});